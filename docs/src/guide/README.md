# Introduction
sss
VuePress is composed of two parts: a [minimalistic static site generator](https://github.com/vuejs/vuepress/tree/master/packages/%40vuepress/core) with a Vue-powered [theming system](https://v1.vuepress.vuejs.org/theme/) and [Plugin API](https://v1.vuepress.vuejs.org/plugin/), and a [default theme](https://v1.vuepress.vuejs.org/theme/default-theme-config.html) optimized for writing technical documentation. It was created to support the documentation needs of Vue's own sub projects.

Okay cool

Each page generated by VuePress has its own pre-rendered static HTML, providing great loading performance and is SEO-friendly. Once the page is loaded, however, Vue takes over the static content and turns it into a full Single-Page Application (SPA). Additional pages are fetched on demand as the user navigates around the site.


# Home

## Technical:

1. *[Caddy](Caddy)* Info about how certs and routing works on Caddy.
2. *[Usage Scenarios](Usage Scenarios)* The "user stories" and some Pseudo Logic on how the uAfrica stores from a
   technical minds eye wil work.
3. *[API Postman](API/uAfrica Stores Control Plane.postman_collection.json)* Postman collection at `API/uAfrica Stores Control Plane.postman_collection.json`

## Custom domain external setup

When a client wants to bring their own domain (BYOD) then they need to create the following DNS records:

**PROD**

|             |             |                |
| ----------- | ----------- | -------------- |
| my-domain.co.za | A | 13.245.86.28 |
| www.my-domain.co.za | CNAME | stores.uafrica.com |

**DEV**

|             |             |                |
| ----------- | ----------- | -------------- |
| my-domain.co.za | A | 13.245.102.6 |
| www.my-domain.co.za | CNAME | stores.dev.uafrica.com

## Miscellaneous

### Limitations of Multiple Network sites on 1 Server

There can be more than one network site on a server. We are currently doing it for the sandbox sites (dev-wp-wp), where
we have rehan.dev, andy.dev and gerhard.dev.uafrica.store on the same server. The problem is apparent when we each
instruct nginx to send all unknown domains to our network install with this line:

```
#echo "server_name ~.;" | sudo tee /etc/nginx/sites-available/wp1.uafrica.store/server/uafrica.conf 
```

So we have to manually specify the custom domain as an additional site for that network site on SpinupWP, this is the only
sure way of telling Nginx to route that custom domain to a certain network install.

***This would not be a problem if it is a single network site on a single server as all custom domains can/will then go to
the same network site.***

### Creating a new Developer Sandbox account

1. Create a SpinupWP multisite install on the `dev-wp.dev.uafrica.store` server.
   Has to be `<your name or anything>.dev.uafrica.store`
1. Create an AWS Secret to be used in the Control Plane. Use existing as template.
1. Create a DB Server record for that SpinupWP Site (aka "server" to the control plane) and this references above created
   secret. Use existing as template.
1. Create a DB Site record for that SpinupWP Site, make sure to mark it as is_network_root and assign server_id to the
   previously created Server. Use existing as template.
1. Manually add the following Caddy Rule "skeleton"/structure/container for that new sites subdomains.
   **!! VERY IMPORTANT: Ordering is extremly important. Caddy uses the first match. So if you are using
   `xxx.dev.uafrica.store`, then the skeleton must be placed above the existing `dev.uafrica.store` skeleton !!**

   More info on the complete structure in the `backend/src/data-plane/initial-config-dev.json` project and file.

   ```json 
   ....
   "routes": [
            {
              "handle": [
                {
                  "@id": "routes - rehan.dev.uafrica.store",
                  "handler": "subroute",
                  "routes": []
                },
                {
                  "handler": "reverse_proxy",
                  "headers": {
                    "request": {
                      "set": {
                        "From": [
                          "dev.uafrica.store"
                        ],
                        "Host": [
                          "{http.request.host}"
                        ],
                        "X-Forwarded-Proto": [
                          "https"
                        ]
                      }
                    }
                  },
                  "upstreams": [
                    {
                      "dial": "10.106.17.221:80"
                    }
                  ]
                }
              ],
              "match": [
                {
                  "host": [
                    "*.rehan.dev.uafrica.store"
                  ]
                }
              ]
            },
            {
              "@id": "rehan.dev.uafrica.store",
              "handle": [
                {
                  "handler": "reverse_proxy",
                  "headers": {
                    "request": {
                      "set": {
                        "From": [
                          "localhost"
                        ],
                        "Host": [
                          "{http.request.host}"
                        ],
                        "X-Forwarded-Proto": [
                          "https"
                        ]
                      }
                    }
                  },
                  "upstreams": [
                    {
                      "dial": "10.106.17.221:80"
                    }
                  ]
                }
              ],
              "match": [
                {
                  "host": [
                    "rehan.dev.uafrica.store"
                  ]
                }
              ]
            },
            
   ```

1. Route53 catch all A record that new domain so that you can create multiple sites. So create a
   `*.<your name or anything>.dev.uafrica.store` DNS `A` record that also points to Caddy.
